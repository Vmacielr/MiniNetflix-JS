
<html lang="fr">
<head>
  <link rel='stylesheet' href='/stylesheets/style.css' />
</head>
<body>

  <header>
    <h1>NetSleep</h1>
    <a class="upload-button" href="/upload">üì§ Uploader une vid√©o</a>
  </header>

  <% if (videos && videos.length > 0) { %>
    <div class="video-gallery">
      <% videos.forEach(function(video, index) { %>
        <div class="video-item" data-index="<%= index %>">
          <% if (video.imageFile) { %>
            <div class="thumbnail-container" data-video="/uploads/<%= encodeURIComponent(video.videoFile) %>">
              <img src="/uploads/<%= encodeURIComponent(video.imageFile) %>" alt="Couverture pour <%= video.title %>" class="video-thumbnail">
              <% if (video.description && video.description.trim() !== "") { %>
                <div class="thumbnail-description"><%= video.description %></div>
              <% } %>
            </div>
          <% } else { %>
            <div class="video-thumbnail-placeholder thumbnail-container" data-video="/uploads/<%= encodeURIComponent(video.videoFile) %>">
              Pas d'image
              <% if (video.description && video.description.trim() !== "") { %>
                <div class="thumbnail-description"><%= video.description %></div>
              <% } %>
            </div>
          <% } %>
          <h3><%= video.title %></h3>
          <p class="video-filename">Fichier: <%= video.originalVideoName %></p>
          <% if (video.uploadedAt) { %>
            <p class="video-upload-date">Upload√© le: <%= new Date(video.uploadedAt).toLocaleDateString('fr-FR') %></p>
          <% } %>
        </div>
      <% }); %>
    </div>
  <% } else { %>
    <p>Aucune vid√©o trouv√©e. <a href="/upload">Pourquoi ne pas en uploader une ?</a></p>
  <% } %>

  <!-- Modal -->
  <div id="video-modal" class="modal">
    <div class="modal-content">
      <span id="modal-close" class="close">&times;</span>
      <video id="modal-video" width="100%" controls>
        <source id="modal-source" src="" type="video/mp4">
        Votre navigateur ne supporte pas la balise vid√©o.
      </video>
    </div>
  </div>

  <script>
    // Ouvre le lecteur quand on clique sur une miniature
    document.querySelectorAll('.thumbnail-container').forEach(container => {
      container.addEventListener('click', () => {
        const videoUrl = container.getAttribute('data-video');
        const modal = document.getElementById('video-modal');
        const video = document.getElementById('modal-video');
        const source = document.getElementById('modal-source');
        source.src = videoUrl;
        video.load();
        modal.style.display = "flex";
      });
    });

    // Ferme la modale
    document.getElementById('modal-close').addEventListener('click', () => {
      document.getElementById('video-modal').style.display = "none";
      document.getElementById('modal-video').pause();
    });

    // Ferme si on clique en dehors
    window.addEventListener('click', (e) => {
      const modal = document.getElementById('video-modal');
      if (e.target === modal) {
        modal.style.display = "none";
        document.getElementById('modal-video').pause();
      }
    });
  </script>

</body>
</html>
